# mamba env update -n <env_name> --file environment.yml --prune
# install pandas msgpack as follows:
# git clone https://github.com/abast/pandas-msgpack.git;
# git -C pandas-msgpack/ apply <project_src>/installer/<py_version>/pandas_msgpack.patch
# cd pandas-msgpack && python setup.py build_ext --inplace --force install
# Verify the verison of msgpack is 0.1.4+14.gfcb0471.dirty
# $ pip list | grep pandas
# pandas                    1.1.3
# pandas-msgpack            0.1.4+14.gfcb0471.dirty
channels:
  - conda-forge
dependencies:
  - python=3.8
  - pyyaml==5.3.1  # Doesn't require Loader arg for yaml.load(). Sumatra doeesnt specify this arg.
  - pip        
  - pip:
    - pandas==1.1.3  # for compatibility with pandas msgpack patch (to be depractaed in the near future)
    - numpy==1.19.2  # needs typeDict for msgpack
    - distributed==2.30.0     
    - dask==2.30.0 # otherwise incompatible with pandas==1.1.3. note that pip/anaconda is not the same (pip version has numpy.int64 divisions, anaconda has json-serializable int)
    - dask[dataframe]==2.30.0
    - flask==1.1.4  # newer flask assumes click.ParameterSource exists (it doesnt). This pins down flask & click to a working combination
    - markupsafe==2.0.1  # flask==1.1.4 ships with a jinja2 version that thinks markupsafe.soft_unicode exists (it doesnt)
    - pytest
    - pytest-xdist
    - neuron==7.8.2  # newer neuron has reproducability error of 0.3% compared to our old simulations (truncation/rounding error)
    - matplotlib
    - scipy
    - redis
    - tables
    - jupyter
    - sumatra  # this requires us to pin down pyyaml - why do we use sumatra?
    - scikit-learn
    - seaborn
    - scandir  # a "better" os.walk()
    - bluepyopt==1.9.126  # we currently still use an older version
    - mock
    - pypdf2
    - SimpleITK
    - pyarrow  # for parquet data format
    - blosc  # compression algorithm
    - dash



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>Generalized Linear Models (GLM) - In Silico Framework</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../_static/sphinx_immaterial_theme.2d7f013d36e4da932.min.css?v=cc46594a" />
        <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
        <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
        <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=68b46a2d" />
        <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
        <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
        <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#Load-multi-scale-model-simulation-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="In Silico Framework" class="md-header__button md-logo" aria-label="In Silico Framework" data-md-component="logo">
      <img src="../../_static/isf-logo-white.png" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            In Silico Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Generalized Linear Models (GLM)
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mpinb/in_silico_framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    in_silico_framework
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../rst_assets/api_reference.html" class="md-tabs__link">
      <span title="/rst_assets/api_reference.rst (reference label)" class="md-ellipsis">API reference</span>
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../../rst_assets/tutorials.html" class="md-tabs__link md-tabs__link--active">
      <span title="/rst_assets/tutorials.rst (reference label)" class="md-ellipsis">Tutorials</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../rst_assets/installation.html" class="md-tabs__link">
      <span title="/rst_assets/installation.rst (reference label)" class="md-ellipsis">Installation</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../rst_assets/file_formats.html" class="md-tabs__link">
      <span title="/rst_assets/file_formats.rst (reference label)" class="md-ellipsis">File &amp; data formats</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../bibliography.html" class="md-tabs__link">
      <span title="/bibliography.rst (reference label)" class="md-ellipsis">Bibliography</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="In Silico Framework" class="md-nav__button md-logo" aria-label="In Silico Framework" data-md-component="logo">
      <img src="../../_static/isf-logo-white.png" alt="logo">
    </a>
    In Silico Framework
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mpinb/in_silico_framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    in_silico_framework
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../rst_assets/api_reference.html" class="md-nav__link">
        <span title="/rst_assets/api_reference.rst (reference label)" class="md-ellipsis">API reference</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../rst_assets/tutorials.html"><span title="/rst_assets/tutorials.rst (reference label)" class="md-ellipsis">Tutorials</span></a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span title="/rst_assets/tutorials.rst (reference label)" class="md-ellipsis">Tutorials</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../Introduction_to_ISF.html" class="md-nav__link">
        <span title="/tutorials/introduction_to_isf.ipynb (reference label)" class="md-ellipsis">Welcome to the In Silico Framework <wbr>(ISF)</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.%20neuron%20models/1.1%20Simulation.html" class="md-nav__link">
        <span title="/tutorials/1. neuron models/1.1 simulation.ipynb (reference label)" class="md-ellipsis">Simulating biophysically detailed multi-<wbr>compartmental models using ISF</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.%20neuron%20models/1.2%20Evaluation.html" class="md-nav__link">
        <span title="/tutorials/1. neuron models/1.2 evaluation.ipynb (reference label)" class="md-ellipsis">Evaluating biophysically detailed multi-<wbr>compartmental models</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.%20neuron%20models/1.3%20Generation.html" class="md-nav__link">
        <span title="/tutorials/1. neuron models/1.3 generation.ipynb (reference label)" class="md-ellipsis">Generating biophysically detailed multi-<wbr>compartmental models</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.%20network%20models/2.1%20Anatomical%20embedding.html" class="md-nav__link">
        <span title="/tutorials/2. network models/2.1 anatomical embedding.ipynb (reference label)" class="md-ellipsis">Embedding a neuron model in a network model</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.%20network%20models/2.2%20Network%20activity.html" class="md-nav__link">
        <span title="/tutorials/2. network models/2.2 network activity.ipynb (reference label)" class="md-ellipsis">Network activity</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../3.%20multiscale%20models/3.1%20Multiscale%20modeling.html" class="md-nav__link">
        <span title="/tutorials/3. multiscale models/3.1 multiscale modeling.ipynb (reference label)" class="md-ellipsis">Multi-<wbr>scale modeling</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb (reference label)" class="md-ellipsis">Generalized Linear Models <wbr>(GLM)</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb (reference label)" class="md-ellipsis">Generalized Linear Models <wbr>(GLM)</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#Load-multi-scale-model-simulation-data" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#load-multi-scale-model-simulation-data (reference label)" class="md-ellipsis">Load multi-<wbr>scale model simulation data</span>
  </a>
  
    <nav class="md-nav" aria-label="Load multi-scale model simulation data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#Load-pre-binned-synapse-activations" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#load-pre-binned-synapse-activations (reference label)" class="md-ellipsis">Load pre-<wbr>binned synapse activations</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Visualise-MCM-responses" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#visualise-mcm-responses (reference label)" class="md-ellipsis">Visualise MCM responses</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#Reduced-model-inference" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#reduced-model-inference (reference label)" class="md-ellipsis">Reduced model inference</span>
  </a>
  
    <nav class="md-nav" aria-label="Reduced model inference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RaisedCosine-basis-functions" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#raisedcosine-basis-functions (reference label)" class="md-ellipsis">Raised<wbr>Cosine basis functions</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Spatiotemporal-filter-inference" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#spatiotemporal-filter-inference (reference label)" class="md-ellipsis">Spatiotemporal filter inference</span>
  </a>
  
    <nav class="md-nav" aria-label="Spatiotemporal filter inference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#Visualize-spatiotemporal-filters" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#visualize-spatiotemporal-filters (reference label)" class="md-ellipsis">Visualize spatiotemporal filters</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Calculate-WNI-values-with-spatiotemporal-filters" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#calculate-wni-values-with-spatiotemporal-filters (reference label)" class="md-ellipsis">Calculate WNI values with spatiotemporal filters</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Nonlinearity" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#nonlinearity (reference label)" class="md-ellipsis">Nonlinearity</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ISI-dependent-penalty" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#isi-dependent-penalty (reference label)" class="md-ellipsis">ISI-<wbr>dependent penalty</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#Reduced-model-simulations" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#reduced-model-simulations (reference label)" class="md-ellipsis">Reduced model simulations</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../rst_assets/installation.html" class="md-nav__link">
        <span title="/rst_assets/installation.rst (reference label)" class="md-ellipsis">Installation</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../rst_assets/file_formats.html" class="md-nav__link">
        <span title="/rst_assets/file_formats.rst (reference label)" class="md-ellipsis">File &amp; data formats</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../bibliography.html" class="md-nav__link">
        <span title="/bibliography.rst (reference label)" class="md-ellipsis">Bibliography</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#Load-multi-scale-model-simulation-data" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#load-multi-scale-model-simulation-data (reference label)" class="md-ellipsis">Load multi-<wbr>scale model simulation data</span>
  </a>
  
    <nav class="md-nav" aria-label="Load multi-scale model simulation data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#Load-pre-binned-synapse-activations" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#load-pre-binned-synapse-activations (reference label)" class="md-ellipsis">Load pre-<wbr>binned synapse activations</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Visualise-MCM-responses" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#visualise-mcm-responses (reference label)" class="md-ellipsis">Visualise MCM responses</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#Reduced-model-inference" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#reduced-model-inference (reference label)" class="md-ellipsis">Reduced model inference</span>
  </a>
  
    <nav class="md-nav" aria-label="Reduced model inference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#RaisedCosine-basis-functions" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#raisedcosine-basis-functions (reference label)" class="md-ellipsis">Raised<wbr>Cosine basis functions</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Spatiotemporal-filter-inference" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#spatiotemporal-filter-inference (reference label)" class="md-ellipsis">Spatiotemporal filter inference</span>
  </a>
  
    <nav class="md-nav" aria-label="Spatiotemporal filter inference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#Visualize-spatiotemporal-filters" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#visualize-spatiotemporal-filters (reference label)" class="md-ellipsis">Visualize spatiotemporal filters</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Calculate-WNI-values-with-spatiotemporal-filters" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#calculate-wni-values-with-spatiotemporal-filters (reference label)" class="md-ellipsis">Calculate WNI values with spatiotemporal filters</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#Nonlinearity" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#nonlinearity (reference label)" class="md-ellipsis">Nonlinearity</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ISI-dependent-penalty" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#isi-dependent-penalty (reference label)" class="md-ellipsis">ISI-<wbr>dependent penalty</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#Reduced-model-simulations" class="md-nav__link">
    <span title="/tutorials/4. reduced models/4.1 generalized linear models.ipynb#reduced-model-simulations (reference label)" class="md-ellipsis">Reduced model simulations</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1 id="Generalized-Linear-Models-(GLM)">Generalized Linear Models (GLM)<a class="headerlink" href="#Generalized-Linear-Models-(GLM)" title="Permalink to this heading">¶</a></h1>
<blockquote>
<div><p>The enormous complexity of biophysically detailed multi-compartmental models at network-level generally prevents the derivation of interpretable descriptions that explain how neurons transform synaptic input into action potential output, and how these input-output computations depend on synaptic, cellular and network properties. Here we introduce an approach to reveal input-output computations that neurons in the cerebral cortex perform upon sensory stimulation. A realistic multi-scale cortex
model is reduced to the minimal description that accounts for in vivo observed responses.</p>
<p><a class="reference external" href="https://doi.org/10.1371/journal.pcbi.1011468">Bast, Fruengel et al. (2024)</a></p>
</div></blockquote>
<p>This tutorial will show how these complex multiscale models can be reduced to the minimum set of parameters that are required to explain the receptive field and latency of responses of L5PTs under the <em>in vivo</em> conditions covered in the previous examples.</p>
<p>Adapt the path below to where you saved the data folder from <a class="reference external" href="https://doi.org/10.7910/DVN/QV7JIF">https://doi.org/10.7910/DVN/QV7JIF</a> (download from Harvard Dataverse)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[5]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">BASEDIR</span> <span class="o">=</span> <span class="s1">&#39;/path/where/you/saved/data/&#39;</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[4]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># append code repository to pythonpath</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s1">&#39;code&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[7]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># import from python ecosystem</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">distributed</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[9]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="o">%</span><span class="k">matplotlib</span> inline
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[10]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">data_base</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">visualize.histogram</span> <span class="kn">import</span> <span class="n">histogram</span>
<span class="kn">from</span> <span class="nn">visualize.rasterplot</span> <span class="kn">import</span> <span class="n">rasterplot</span>
<span class="kn">from</span> <span class="nn">data_base.analyze.temporal_binning</span> <span class="kn">import</span> <span class="n">temporal_binning_pd</span>

<span class="kn">import</span> <span class="nn">Interface</span> <span class="k">as</span> <span class="nn">I</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[12]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># set up a dask cluster as described here: https://distributed.dask.org/en/stable/quickstart.html</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
<span class="n">client</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[12]:
</code></pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table style="border: 2px solid white;">
<tr>
<td style="vertical-align: top; border: 0px solid white">
<h3>Client</h3>
<ul>
  <li><b>Scheduler: </b>tcp://130.183.178.97:28786
  <li><b>Dashboard: </b><a href='http://130.183.178.97:28787/status' target='_blank'>http://130.183.178.97:28787/status</a>
</ul>
</td>
<td style="vertical-align: top; border: 0px solid white">
<h3>Cluster</h3>
<ul>
  <li><b>Workers: </b>20</li>
  <li><b>Cores: </b>20</li>
  <li><b>Memory: </b>2.00 TB</li>
</ul>
</td>
</tr>
</table></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[12]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">whiskers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B1&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="s1">&#39;D2&#39;</span><span class="p">,</span> <span class="s1">&#39;D3&#39;</span><span class="p">,</span> <span class="s1">&#39;E2&#39;</span><span class="p">]</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[16]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">models</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<h2 id="Load-multi-scale-model-simulation-data">Load multi-scale model simulation data<a class="headerlink" href="#Load-multi-scale-model-simulation-data" title="Permalink to this heading">¶</a></h2>
<h3 id="Load-pre-binned-synapse-activations">Load pre-binned synapse activations<a class="headerlink" href="#Load-pre-binned-synapse-activations" title="Permalink to this heading">¶</a></h3>
<p>This is the synaptic input received by the multi-compartmental model (MCM) in principal whisker simulations. Another visualisation of this input can be seen in Fig. 1F, where the spatial distribution is also shown.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[15]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">whisker</span> <span class="o">=</span> <span class="s1">&#39;C2&#39;</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[16]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># each compressed numpy archive contains a single numpy array</span>
<span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__binned_synapse_activations_spatiotemporal_EI__</span><span class="si">{}</span><span class="s2">.npz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">))</span>
<span class="n">sa</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="s1">&#39;arr_0&#39;</span><span class="p">]</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[17]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">sa</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># (excitatory/inhibitory, spatial bins, trials, temporal bins)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[17]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(2, 30, 81000, 400)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[18]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">saexc</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">sainh</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[19]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># get mean count of active synapses onto the whole neuron in each timebin</span>
<span class="n">saexc_mean</span> <span class="o">=</span> <span class="n">saexc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">sainh_mean</span> <span class="o">=</span> <span class="n">sainh</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[20]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">histogram</span><span class="p">((</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">401</span><span class="p">)),</span> <span class="n">saexc_mean</span><span class="p">),</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;excitatory&#39;</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;excitatory&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">})</span>
<span class="n">histogram</span><span class="p">((</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">401</span><span class="p">)),</span> <span class="n">sainh_mean</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;inhibitory&#39;</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inhibitory&#39;</span><span class="p">:</span><span class="s1">&#39;navy&#39;</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">345</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;number of active synapses&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[20]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.text.Text at 0x2b97bd46b910&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_19_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_19_1.png" />
</div>
</div>
<h3 id="Visualise-MCM-responses">Visualise MCM responses<a class="headerlink" href="#Visualise-MCM-responses" title="Permalink to this heading">¶</a></h3>
<p>These are the responses of the MCM to the above synaptic input (also shown in Fig. 1I).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[21]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">whisker</span> <span class="o">=</span> <span class="s1">&#39;C2&#39;</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[22]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># load spike times for a principal whisker stimulus</span>
<span class="n">st</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__spike_times_MCM__</span><span class="si">{}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">))</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[45]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># the sensory stimulus was always applied at 245 ms, because</span>
<span class="c1"># the multi-compartmental model needs some time from initialisation to reach a steady state</span>
<span class="c1"># therefore the first 150 ms of each simulation should be discarded - spikes in this period are initialisation artefacts</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">temporal_binning_pd</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">min_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max_time</span> <span class="o">=</span> <span class="mi">345</span><span class="p">,</span> <span class="n">bin_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;AP probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;average whisker stimulus response (MCM)&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[45]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.text.Text at 0x2b448b48f050&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_24_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_24_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[48]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">rasterplot</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">4000</span><span class="p">:</span><span class="mi">6000</span><span class="p">],</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;trial index&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[48]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.text.Text at 0x2b448b557b90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_25_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_25_1.png" />
</div>
</div>
<h2 id="Reduced-model-inference">Reduced model inference<a class="headerlink" href="#Reduced-model-inference" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[16]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># we will store all the parameters of the reduced models in a dictionary</span>
<span class="c1"># here we show how to make a reduced model from one exemplary multi-compartmental model</span>
<span class="c1"># the procedure was repeated for all 7 MCMs</span>
<span class="n">rm_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[17]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">modular_reduced_model_inference</span>
<span class="kn">from</span> <span class="nn">modular_reduced_model_inference</span> <span class="kn">import</span> <span class="n">RaisedCosineBasis</span>
</code></pre></div>
</div>
</div>
<h3 id="RaisedCosine-basis-functions">RaisedCosine basis functions<a class="headerlink" href="#RaisedCosine-basis-functions" title="Permalink to this heading">¶</a></h3>
<p>The spatial and temporal filters are composed of a set of basis functions:</p>
<p><span class="math notranslate nohighlight">\(w_\tau = \sum_i x_i f_i(\tau) = \mathbf{x} \cdot \mathbf{f}(\tau)\)</span></p>
<p><span class="math notranslate nohighlight">\(w_z = \sum_i y_i g_i(z) = \mathbf{y} \cdot \mathbf{g}(z)\)</span></p>
<p>Here, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> are learnable parameters, and <span class="math notranslate nohighlight">\(\mathbf{f}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{g}\)</span> are vectors of basis functions. These basis functions are raised cosines, which have the following form:</p>
<p><span class="math notranslate nohighlight">\(f(x) = \frac{1}{2}cos(a \cdot log[x+c] - \phi_i) + \frac{1}{2}\)</span></p>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(\phi\)</span> are set depending on the required resolution. note that <span class="math notranslate nohighlight">\(\phi_i\)</span> has a different value depending on the basis vector index.</div>
<div class="line">The spatial filters need resolution close to the soma, so <span class="math notranslate nohighlight">\(a=3\)</span>, <span class="math notranslate nohighlight">\(c=5\)</span> (see visualizations below), and we only require <span class="math notranslate nohighlight">\(6\)</span> basis vectors.</div>
<div class="line">Temporal filters need resolution close to the AP onset, so <span class="math notranslate nohighlight">\(a=2\)</span>, <span class="math notranslate nohighlight">\(c=1\)</span> (see visualizations below), and as we need more resolution, we have <span class="math notranslate nohighlight">\(20\)</span> basis vectors.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[18]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">RaisedCosineBasis_spatial</span> <span class="o">=</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">RaisedCosineBasis</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">reversed_</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">RaisedCosineBasis_temporal</span> <span class="o">=</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">RaisedCosineBasis</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">reversed_</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[19]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># the basis functions for the spatial filters</span>
<span class="c1"># the weight applied to each of these functions is the target of the optimiser</span>
<span class="n">RaisedCosineBasis_spatial</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_31_0.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_31_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[20]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># the basis functions for the temporal filters</span>
<span class="n">RaisedCosineBasis_temporal</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_32_0.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_32_0.png" />
</div>
</div>
<h3 id="Spatiotemporal-filter-inference">Spatiotemporal filter inference<a class="headerlink" href="#Spatiotemporal-filter-inference" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[21]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># we also provide precomputed spatiotemporal filters for all models used in our paper</span>
<span class="c1"># which are visualized in the next section</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[22]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">whiskers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C2&#39;</span><span class="p">]</span> <span class="c1"># it is also possible to infer reduced models from only a subset of the data. We use this here as an example,</span>
<span class="c1"># with only the principal (C2) whisker. To run inference on the full dataset, uncomment the line below:</span>
<span class="c1"># whiskers = [&#39;B1&#39;, &#39;B2&#39;, &#39;B3&#39;, &#39;C1&#39;, &#39;C2&#39;, &#39;C3&#39;, &#39;D1&#39;, &#39;D2&#39;, &#39;D3&#39;, &#39;E2&#39;]</span>
<span class="c1"># be aware that a large amount of RAM is necessary to handle the full dataset</span>

<span class="n">mdb_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">whisker</span> <span class="ow">in</span> <span class="n">whiskers</span><span class="p">:</span>
    <span class="n">mdb_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;spike_times&#39;</span><span class="p">:</span> <span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__spike_times_MCM__</span><span class="si">{}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">),</span>
           <span class="s1">&#39;binned_synapse_activation&#39;</span><span class="p">:</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__binned_synapse_activations_spatiotemporal_EI__</span><span class="si">{}</span><span class="s2">.npz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">)})</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[24]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># this cell takes a few minutes to run as it loads and uncompresses all the MCM simulation data</span>
<span class="c1"># uncompression takes a long time so you may want to save the uncompressed array in case you want to use it again</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="n">rm</span> <span class="o">=</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">Rm</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
    <span class="n">mdb</span> <span class="o">=</span> <span class="n">mdb_list</span><span class="p">,</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="mi">260</span><span class="p">,</span> <span class="c1">#timepoint_of_max_response</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="mi">261</span><span class="p">,</span> <span class="c1">#timepoint_of_max_response+1</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span><span class="p">)</span>

<span class="c1"># make simulation data available to the reduced model</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">DataExtractor_spatiotemporalSynapseActivation</span>
<span class="n">rm</span><span class="o">.</span><span class="n">add_data_extractor</span><span class="p">(</span><span class="s1">&#39;spatiotemporalSa&#39;</span><span class="p">,</span> <span class="n">D</span><span class="p">())</span>
<span class="n">rm</span><span class="o">.</span><span class="n">add_data_extractor</span><span class="p">(</span><span class="s1">&#39;st&#39;</span><span class="p">,</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">DataExtractor_spiketimes</span><span class="p">())</span>
<span class="n">rm</span><span class="o">.</span><span class="n">add_data_extractor</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">DataExtractor_spikeInInterval</span><span class="p">())</span>
<span class="n">rm</span><span class="o">.</span><span class="n">add_data_extractor</span><span class="p">(</span><span class="s1">&#39;ISI&#39;</span><span class="p">,</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">DataExtractor_ISI</span><span class="p">())</span>
</code></pre></div>
</div>
</div>
<p>The code above made the data available to the reduced model object, and cropped out data w.r.t. the selected timepoints</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[25]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">st</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">data_extractors</span><span class="p">[</span><span class="s1">&#39;st&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="c1"># spike times</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[26]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># the reduced model considers spike times up to tmax</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">temporal_binning_pd</span><span class="p">(</span><span class="n">st</span><span class="p">),</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;AP probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;average whisker stimulus response (MCM)&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[26]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.text.Text at 0x2b3c506b9e10&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_39_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_39_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[27]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># define a strategy which evaluates simulation trials based on spatiotemporal filters</span>
<span class="n">RaisedCosineBasis_spatial</span> <span class="o">=</span> <span class="n">RaisedCosineBasis</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">reversed_</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">RaisedCosineBasis_temporal</span> <span class="o">=</span> <span class="n">RaisedCosineBasis</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">reversed_</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">len_z</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RaisedCosineBasis_spatial</span><span class="o">.</span><span class="n">phis</span><span class="p">)</span> <span class="c1"># number of parameters of the spatial filter</span>
<span class="n">len_t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RaisedCosineBasis_temporal</span><span class="o">.</span><span class="n">phis</span><span class="p">)</span>  <span class="c1"># number of parameters of the temporal filter</span>
<span class="n">strategy</span> <span class="o">=</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">Strategy_spatiotemporalRaisedCosine</span><span class="p">(</span><span class="s1">&#39;SAspatiotemporalRaisedCosine&#39;</span><span class="p">,</span> <span class="n">RaisedCosineBasis_spatial</span><span class="p">,</span> <span class="n">RaisedCosineBasis_temporal</span><span class="p">)</span>

<span class="n">rm</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>

<span class="c1"># add solver</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">Solver_COBYLA</span><span class="p">(</span><span class="s1">&#39;cobyla&#39;</span><span class="p">)</span>
<span class="n">strategy</span><span class="o">.</span><span class="n">add_solver</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span>

<span class="k">for</span> <span class="n">lv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="c1"># make 3 random train/test splits</span>
    <span class="c1"># rm.DataSplitEvaluation.add_random_split(&#39;.7_{}&#39;.format(lv), percentage_train=.7)</span>
    <span class="n">rm</span><span class="o">.</span><span class="n">DataSplitEvaluation</span><span class="o">.</span><span class="n">add_isi_dependent_random_split</span><span class="p">(</span><span class="s1">&#39;ISI50_.7_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lv</span><span class="p">),</span><span class="n">min_isi</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">percentage_train</span><span class="o">=</span><span class="mf">.7</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[28]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">lv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">rm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
starting remote optimization SAspatiotemporalRaisedCosine cobyla
starting remote optimization SAspatiotemporalRaisedCosine cobyla
starting remote optimization SAspatiotemporalRaisedCosine cobyla
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[30]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">result_df</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="c1"># If you get ValueError: Only one class present in y_true. ROC AUC score is not defined in that case, it means that the</span>
<span class="c1"># reduced model failed (this happens for example due to a lack of spikes in the interval used for inference)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[31]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">result_df</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[31]:
</code></pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>score</th>
      <th>success</th>
      <th>x</th>
    </tr>
    <tr>
      <th>strategy</th>
      <th>solver</th>
      <th>split</th>
      <th>subsplit</th>
      <th>run</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="36" valign="top">SAspatiotemporalRaisedCosine</th>
      <th rowspan="36" valign="top">cobyla</th>
      <th rowspan="12" valign="top">ISI50_.7_0</th>
      <th rowspan="3" valign="top">subtest1</th>
      <th>0</th>
      <td>-0.992066</td>
      <td>False</td>
      <td>[0.959447821583, 0.127607023899, 1.0997403028,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.993329</td>
      <td>False</td>
      <td>[4.94194310094, 4.53524909301, 2.72658190132, ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.992040</td>
      <td>False</td>
      <td>[3.21385300474, 0.511869924346, 1.29909420539,...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">subtest2</th>
      <th>0</th>
      <td>-0.989921</td>
      <td>False</td>
      <td>[0.959447821583, 0.127607023899, 1.0997403028,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.990491</td>
      <td>False</td>
      <td>[4.94194310094, 4.53524909301, 2.72658190132, ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.989427</td>
      <td>False</td>
      <td>[3.21385300474, 0.511869924346, 1.29909420539,...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">test</th>
      <th>0</th>
      <td>-0.991523</td>
      <td>False</td>
      <td>[0.959447821583, 0.127607023899, 1.0997403028,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.992149</td>
      <td>False</td>
      <td>[4.94194310094, 4.53524909301, 2.72658190132, ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.991154</td>
      <td>False</td>
      <td>[3.21385300474, 0.511869924346, 1.29909420539,...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">train</th>
      <th>0</th>
      <td>-0.984188</td>
      <td>False</td>
      <td>[0.959447821583, 0.127607023899, 1.0997403028,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.985860</td>
      <td>False</td>
      <td>[4.94194310094, 4.53524909301, 2.72658190132, ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.983728</td>
      <td>False</td>
      <td>[3.21385300474, 0.511869924346, 1.29909420539,...</td>
    </tr>
    <tr>
      <th rowspan="12" valign="top">ISI50_.7_1</th>
      <th rowspan="3" valign="top">subtest1</th>
      <th>0</th>
      <td>-0.992268</td>
      <td>False</td>
      <td>[0.617738981647, 4.44972179139, -0.15160990483...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.991068</td>
      <td>False</td>
      <td>[-0.917824891731, 1.87739540229, 0.20091202048...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.990466</td>
      <td>False</td>
      <td>[2.37342377281, 1.06038573381, 0.254391539931,...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">subtest2</th>
      <th>0</th>
      <td>-0.990166</td>
      <td>False</td>
      <td>[0.617738981647, 4.44972179139, -0.15160990483...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.989424</td>
      <td>False</td>
      <td>[-0.917824891731, 1.87739540229, 0.20091202048...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.987997</td>
      <td>False</td>
      <td>[2.37342377281, 1.06038573381, 0.254391539931,...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">test</th>
      <th>0</th>
      <td>-0.991684</td>
      <td>False</td>
      <td>[0.617738981647, 4.44972179139, -0.15160990483...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.990862</td>
      <td>False</td>
      <td>[-0.917824891731, 1.87739540229, 0.20091202048...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.989854</td>
      <td>False</td>
      <td>[2.37342377281, 1.06038573381, 0.254391539931,...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">train</th>
      <th>0</th>
      <td>-0.985018</td>
      <td>False</td>
      <td>[0.617738981647, 4.44972179139, -0.15160990483...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.982940</td>
      <td>False</td>
      <td>[-0.917824891731, 1.87739540229, 0.20091202048...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.981275</td>
      <td>False</td>
      <td>[2.37342377281, 1.06038573381, 0.254391539931,...</td>
    </tr>
    <tr>
      <th rowspan="12" valign="top">ISI50_.7_2</th>
      <th rowspan="3" valign="top">subtest1</th>
      <th>0</th>
      <td>-0.992971</td>
      <td>True</td>
      <td>[-1.17808668604, -2.90042159759, -0.4544114625...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.992882</td>
      <td>True</td>
      <td>[-0.397515253276, -1.95891392491, -0.561910247...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.992944</td>
      <td>False</td>
      <td>[1.67019871925, 2.8916096642, 2.52633336423, -...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">subtest2</th>
      <th>0</th>
      <td>-0.990368</td>
      <td>True</td>
      <td>[-1.17808668604, -2.90042159759, -0.4544114625...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.990534</td>
      <td>True</td>
      <td>[-0.397515253276, -1.95891392491, -0.561910247...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.990600</td>
      <td>False</td>
      <td>[1.67019871925, 2.8916096642, 2.52633336423, -...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">test</th>
      <th>0</th>
      <td>-0.991989</td>
      <td>True</td>
      <td>[-1.17808668604, -2.90042159759, -0.4544114625...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.992090</td>
      <td>True</td>
      <td>[-0.397515253276, -1.95891392491, -0.561910247...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.992083</td>
      <td>False</td>
      <td>[1.67019871925, 2.8916096642, 2.52633336423, -...</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">train</th>
      <th>0</th>
      <td>-0.985961</td>
      <td>True</td>
      <td>[-1.17808668604, -2.90042159759, -0.4544114625...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.985813</td>
      <td>True</td>
      <td>[-0.397515253276, -1.95891392491, -0.561910247...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.985702</td>
      <td>False</td>
      <td>[1.67019871925, 2.8916096642, 2.52633336423, -...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<h4 id="Visualize-spatiotemporal-filters">Visualize spatiotemporal filters<a class="headerlink" href="#Visualize-spatiotemporal-filters" title="Permalink to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[33]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">RaisedCosineBasis_spatial</span> <span class="o">=</span> <span class="n">RaisedCosineBasis</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">reversed_</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">RaisedCosineBasis_temporal</span> <span class="o">=</span> <span class="n">RaisedCosineBasis</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">reversed_</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">strategy</span> <span class="o">=</span> <span class="n">modular_reduced_model_inference</span><span class="o">.</span><span class="n">Strategy_spatiotemporalRaisedCosine</span><span class="p">(</span>
    <span class="s1">&#39;SAspatiotemporalRaisedCosine&#39;</span><span class="p">,</span>
    <span class="n">RaisedCosineBasis_spatial</span><span class="p">,</span>
    <span class="n">RaisedCosineBasis_temporal</span><span class="p">)</span>
<span class="c1"># manually do what happens in rm.add_strategy(strategy) in order to get the shape of the basis functions</span>
<span class="c1"># this avoids having to load in the dataset</span>
<span class="n">strategy</span><span class="o">.</span><span class="n">len_z</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RaisedCosineBasis_spatial</span><span class="o">.</span><span class="n">phis</span><span class="p">)</span> <span class="c1"># number of parameters of the spatial filter</span>
<span class="n">strategy</span><span class="o">.</span><span class="n">len_t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RaisedCosineBasis_temporal</span><span class="o">.</span><span class="n">phis</span><span class="p">)</span>  <span class="c1"># number of parameters of the temporal filter</span>
<span class="n">strategy</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;EXC&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s1">&#39;INH&#39;</span><span class="p">,)]</span> <span class="c1"># excitatory and inhibitory</span>
<span class="n">strategy</span><span class="o">.</span><span class="n">convert_x</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">_convert_x_static</span><span class="p">,</span> <span class="n">strategy</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span> <span class="n">strategy</span><span class="o">.</span><span class="n">len_z</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[34]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># the reduced model filters have one unconstrained parameter: they can be multiplied by a scalar</span>
<span class="c1"># normalize such that excitatory weight in the spatial filter at soma distance 0 is 1</span>
<span class="n">strategy</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">result_df</span><span class="p">,</span> <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_46_0.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_46_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[35]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># visualize models before normalization</span>
<span class="n">strategy</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">result_df</span><span class="p">,</span> <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_47_0.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_47_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[36]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># get numerical values of kernels visualized above</span>
<span class="n">index_best_model</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="n">spatiotemporal_filters</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_kernel_dict</span><span class="p">(</span><span class="n">result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index_best_model</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">spatiotemporal_filters</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[36]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;s_exc&#39;: array([ 0.99999994,  0.83999312,  0.67933828,  0.54754567,  0.42797816,
         0.32122907,  0.23403572,  0.16860136,  0.12514773,  0.09235044,
         0.06582323,  0.04554006,  0.03117438,  0.02222843,  0.01811939,
         0.01823592,  0.02197397,  0.0273118 ,  0.03221476,  0.03664161,
         0.04057404,  0.04400725,  0.04694676,  0.04940576,  0.05140304,
         0.05296133,  0.05410602,  0.05486407,  0.05526331,  0.05533172], dtype=float32),
 &#39;s_inh&#39;: array([  7.93388784e-01,   6.80935025e-01,   5.25943398e-01,
          3.73791099e-01,   2.47634768e-01,   1.55127957e-01,
          9.60600004e-02,   6.68410510e-02,   6.18851073e-02,
          6.21100441e-02,   6.06311373e-02,   5.78291751e-02,
          5.40423021e-02,   4.95610572e-02,   4.46290970e-02,
          3.94468531e-02,   3.41763236e-02,   2.90312413e-02,
          2.42002122e-02,   1.97337605e-02,   1.56642124e-02,
          1.20097343e-02,   8.77735205e-03,   5.96547779e-03,
          3.56593728e-03,   1.56562449e-03,  -5.21633774e-05,
         -1.30666094e-03,  -2.21877987e-03,  -2.81043258e-03], dtype=float32),
 &#39;t_exc&#39;: array([-0.02400237, -0.02032194, -0.01662141, -0.01290308, -0.00916938,
        -0.00542588, -0.00174317,  0.00184482,  0.0053307 ,  0.00870685,
         0.01196511,  0.01509703,  0.01809369,  0.02094587,  0.02364372,
         0.02617702,  0.02853503,  0.0307065 ,  0.03267968,  0.0344422 ,
         0.03598117,  0.03728301,  0.03837968,  0.03944859,  0.04050721,
         0.04155323,  0.04258426,  0.04359765,  0.04459048,  0.04555977,
         0.04650225,  0.04741433,  0.04829218,  0.04913172,  0.04992854,
         0.05067915,  0.05138324,  0.05203624,  0.05263265,  0.05316664,
         0.05363193,  0.05403322,  0.05440999,  0.05476375,  0.0550912 ,
         0.05543467,  0.05603194,  0.05693725,  0.05817533,  0.05977213,
         0.06172585,  0.06401034,  0.06664608,  0.06978153,  0.07385685,
         0.07898357,  0.085251  ,  0.09283666,  0.10192585,  0.11262625,
         0.12500095,  0.13914779,  0.15533496,  0.17417821,  0.19665515,
         0.22482018,  0.25910693,  0.29907584,  0.34764871,  0.40801415,
         0.48474893,  0.58128369,  0.69691992,  0.82134211,  0.9336347 ,
         1.        ,  0.97017372,  0.79743534,  0.46252084, -0.02363155], dtype=float32),
 &#39;t_inh&#39;: array([-0.04599673, -0.04736574, -0.04880098, -0.05030387, -0.05187581,
        -0.05352015, -0.05528356, -0.05718811, -0.05923788, -0.06143703,
        -0.06378973, -0.06630028, -0.06897295, -0.07181212, -0.07482215,
        -0.07800741, -0.08137235, -0.08492143, -0.08865899, -0.09258938,
        -0.09671696, -0.10104594, -0.10560232, -0.11048119, -0.11570197,
        -0.12127499, -0.12721042, -0.13351859, -0.14020956, -0.14729342,
        -0.15477996, -0.16267864, -0.17099871, -0.17974874, -0.18893673,
        -0.19859833, -0.20884515, -0.21970053, -0.23117824, -0.24329092,
        -0.2560496 , -0.269458  , -0.28349999, -0.29817542, -0.31348261,
        -0.3294391 , -0.34615639, -0.3636474 , -0.38190308, -0.40090674,
        -0.42065942, -0.44117498, -0.46241164, -0.48448306, -0.50787866,
        -0.53262049, -0.55867487, -0.58596104, -0.61436367, -0.64381152,
        -0.6744687 , -0.70618039, -0.73851043, -0.77058583, -0.80224133,
        -0.83385348, -0.8649801 , -0.89593261, -0.92658406, -0.956218  ,
        -0.98191792, -0.9982118 , -1.00000012, -0.98073751, -0.92507899,
        -0.81327784, -0.63900936, -0.38829231, -0.06644553,  0.14063495], dtype=float32)}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[37]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;spatiotemporal_filters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatiotemporal_filters</span>
</code></pre></div>
</div>
</div>
<h3 id="Calculate-WNI-values-with-spatiotemporal-filters">Calculate WNI values with spatiotemporal filters<a class="headerlink" href="#Calculate-WNI-values-with-spatiotemporal-filters" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[86]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># calculate all the WNI values at relevant timepoints - we will need them again to estimate the ISI-dependent penalty</span>
<span class="nd">@dask</span><span class="o">.</span><span class="n">delayed</span>
<span class="k">def</span> <span class="nf">calculate_WNI_values</span><span class="p">(</span><span class="n">sa_file</span><span class="p">,</span> <span class="n">kernel_dict</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">,</span> <span class="n">outdir</span><span class="p">):</span>

    <span class="n">timebins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">271</span><span class="p">))</span>

    <span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sa_file</span><span class="p">)</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="s1">&#39;arr_0&#39;</span><span class="p">]</span>
    <span class="n">n_cells</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">WNI_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cells</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">271</span><span class="p">))</span>
    <span class="n">SAexc</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,:]</span>
    <span class="n">SAinh</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:,:]</span>


    <span class="n">SAexc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">SAexc</span><span class="p">)</span>
    <span class="n">SAinh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">SAinh</span><span class="p">)</span>

    <span class="n">s_exc</span> <span class="o">=</span> <span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;s_exc&#39;</span><span class="p">]</span>
    <span class="n">s_inh</span> <span class="o">=</span> <span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;s_inh&#39;</span><span class="p">]</span>
    <span class="n">t_exc</span> <span class="o">=</span> <span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;t_exc&#39;</span><span class="p">]</span>
    <span class="n">t_inh</span> <span class="o">=</span> <span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;t_inh&#39;</span><span class="p">]</span>



    <span class="n">SAinh_cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">n_cells</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
    <span class="n">SAexc_cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">n_cells</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">timebin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">220</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">271</span><span class="p">)):</span> <span class="c1"># for all timebins relevant to period of interest</span>
        <span class="c1">## get excitatory and inhibitory input, spatially binned for the CURRENT timebin</span>
        <span class="n">SAexc_timebin</span> <span class="o">=</span> <span class="n">SAexc</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">timebin</span><span class="p">]</span>
        <span class="n">SAinh_timebin</span> <span class="o">=</span> <span class="n">SAinh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">timebin</span><span class="p">]</span>

        <span class="c1">## apply spatial kernel to the current timebin</span>
        <span class="n">SAexc_timebin</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAexc_timebin</span><span class="p">,</span> <span class="n">s_exc</span><span class="p">)])</span>
        <span class="n">SAinh_timebin</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAinh_timebin</span><span class="p">,</span> <span class="n">s_inh</span><span class="p">)])</span>



        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cells</span><span class="p">):</span>
            <span class="n">SAinh_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="p">]</span> <span class="o">=</span> <span class="n">SAinh_timebin</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span>
            <span class="n">SAexc_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="p">]</span> <span class="o">=</span> <span class="n">SAexc_timebin</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span>



    <span class="c1">## apply temporal kernel to timebins of interest</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">timebin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">271</span><span class="p">)):</span>
<span class="c1">#         print timebin</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cells</span><span class="p">):</span>

            <span class="n">SAexc_window</span> <span class="o">=</span> <span class="n">SAexc_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="o">-</span><span class="mi">79</span><span class="p">:</span><span class="n">timebin</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">SAinh_window</span> <span class="o">=</span> <span class="n">SAinh_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="o">-</span><span class="mi">79</span><span class="p">:</span><span class="n">timebin</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>



            <span class="n">SAexc_window</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAexc_window</span><span class="p">,</span> <span class="n">t_exc</span><span class="p">)])</span>
            <span class="n">SAinh_window</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAinh_window</span><span class="p">,</span> <span class="n">t_inh</span><span class="p">)])</span>

            <span class="c1">## get weighted net input for each cell</span>
            <span class="n">WNI</span> <span class="o">=</span> <span class="n">SAexc_window</span> <span class="o">+</span> <span class="n">SAinh_window</span>
            <span class="n">WNI_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cell</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">WNI</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;model_</span><span class="si">{}</span><span class="s1">__</span><span class="si">{}</span><span class="s1">.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">)</span>
    <span class="n">WNI_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[ ]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># we provide WNI values for the exemplary spatiotemporal filters generated in this notebook under the following key:</span>
<span class="n">outdir</span> <span class="o">=</span> <span class="n">BASEDIR</span> <span class="o">+</span> <span class="s1">&#39;precalculated_WNI_values__model_1__C2&#39;</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[72]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># to calculate them yourself, make a folder to store them in:</span>
<span class="n">outdir</span> <span class="o">=</span> <span class="n">BASEDIR</span> <span class="o">+</span> <span class="s1">&#39;precalculated_WNI_values/&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[87]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># takes about 20 mins per whisker on a single core</span>
<span class="n">delayeds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">whisker</span> <span class="ow">in</span> <span class="n">whiskers</span><span class="p">:</span>
    <span class="n">sa_file</span> <span class="o">=</span> <span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__binned_synapse_activations_spatiotemporal_EI__</span><span class="si">{}</span><span class="s2">.npz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">calculate_WNI_values</span><span class="p">(</span><span class="n">sa_file</span><span class="p">,</span> <span class="n">spatiotemporal_filters</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>
    <span class="n">delayeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">))</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[88]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># to prevent memory issues - each worker will load around 25GB of data</span>
<span class="c1"># adjust the number of cores working per node according to your memory limits</span>
<span class="n">workers_per_node</span> <span class="o">=</span> <span class="mi">5</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="n">workers</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">scheduler_info</span><span class="p">()[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">workers</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">workers</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">w</span><span class="p">)[:</span><span class="n">workers_per_node</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">workers</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[89]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">futures</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">delayeds</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<h3 id="Nonlinearity">Nonlinearity<a class="headerlink" href="#Nonlinearity" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[91]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">group_bins</span><span class="p">(</span><span class="n">helper_df</span><span class="p">,</span> <span class="n">min_items</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="c1"># https://codereview.stackexchange.com/questions/12753/taking-the-first-few-items-of-a-list-until-a-target-sum-is-exceeded/12759</span>

    <span class="n">total_items</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rows_to_group</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">groupings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">helper_df</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>

        <span class="n">items</span> <span class="o">=</span> <span class="n">helper_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">total_items</span> <span class="o">+=</span> <span class="n">items</span> <span class="c1"># keep a running total of number of datapoints</span>
        <span class="n">rows_to_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">total_items</span> <span class="o">&gt;=</span> <span class="n">min_items</span><span class="p">:</span> <span class="c1"># once we have enough datapoints, save the grouping and continue</span>
            <span class="n">total_items</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">groupings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows_to_group</span><span class="p">)</span>
            <span class="n">rows_to_group</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">helper_df</span><span class="o">.</span><span class="n">index</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="c1"># or if it&#39;s the last bin, which might get skipped otherwise</span>
            <span class="n">groupings</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="p">])</span>

    <span class="c1"># check if the last bin is too small, merge with second to last if it is</span>
    <span class="n">last_binsize</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">groupings</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">last_binsize</span> <span class="o">+=</span> <span class="n">helper_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">last_binsize</span> <span class="o">&lt;</span> <span class="n">min_items</span><span class="p">:</span>
        <span class="n">new_grouping</span> <span class="o">=</span> <span class="n">groupings</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">last_bins</span> <span class="o">=</span> <span class="n">groupings</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">new_grouping</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">last_bins</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
        <span class="n">groupings</span> <span class="o">=</span> <span class="n">new_grouping</span>

    <span class="k">return</span> <span class="n">groupings</span>

<span class="k">def</span> <span class="nf">signchange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">linear_interpolation_between_pairs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="s1">&#39;min&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">top</span> <span class="o">==</span> <span class="s1">&#39;inf&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">elif</span> <span class="n">top</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bottom</span> <span class="o">==</span> <span class="s1">&#39;inf&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">elif</span> <span class="n">bottom</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span> <span class="c1"># don&#39;t need to interpolate, causes assertion error</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="p">[</span><span class="n">lv</span> <span class="k">for</span> <span class="n">lv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">signchange</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">lv</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">lv</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">)]</span>
<span class="c1">#         X[lv] &lt;= x &lt; X[lv + 1]]</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">pair</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Y</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">pair</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">c</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">variable_stepsize_nonlinearity</span><span class="p">(</span><span class="n">wni_values</span><span class="p">,</span> <span class="n">spike_times</span><span class="p">,</span> <span class="n">spike_before</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lookup_series_stepsize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">min_items</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">pdf2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">wni_values</span> <span class="o">=</span> <span class="n">wni_values</span><span class="p">,</span> <span class="n">spike</span> <span class="o">=</span> <span class="n">spike_times</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">spike_before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdf2</span><span class="p">[</span><span class="o">~</span><span class="n">spike_before</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdf2</span>

    <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">pdf</span><span class="p">[</span><span class="s1">&#39;wni_values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">pdf</span><span class="p">[</span><span class="s1">&#39;wni_values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span> <span class="o">+</span> <span class="n">lookup_series_stepsize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lookup_series_stepsize</span><span class="p">)</span>
    <span class="n">pdf</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">pdf</span><span class="p">[</span><span class="s1">&#39;wni_values&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">helper_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spike_prob</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spikes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">pdf</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]):</span>
        <span class="n">b_pdf</span> <span class="o">=</span> <span class="n">pdf</span><span class="p">[</span><span class="n">pdf</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">]</span>
        <span class="n">n_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_pdf</span><span class="p">))</span>
        <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="n">spike_prob</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b_pdf</span><span class="p">[</span><span class="s1">&#39;spike&#39;</span><span class="p">]))</span>
        <span class="n">spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">b_pdf</span><span class="p">[</span><span class="s1">&#39;spike&#39;</span><span class="p">]))</span>

    <span class="n">helper_df</span><span class="p">[</span><span class="s1">&#39;bin_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span>
    <span class="n">helper_df</span><span class="p">[</span><span class="s1">&#39;spike_prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spike_prob</span>
    <span class="n">helper_df</span><span class="p">[</span><span class="s1">&#39;spikes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spikes</span>
    <span class="n">helper_df</span><span class="p">[</span><span class="s1">&#39;n_items&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_items</span>
    <span class="n">helper_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;bin_start&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">bin_groupings</span> <span class="o">=</span> <span class="n">group_bins</span><span class="p">(</span><span class="n">helper_df</span><span class="p">,</span> <span class="n">min_items</span> <span class="o">=</span> <span class="n">min_items</span><span class="p">)</span>
    <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bin_start&#39;</span><span class="p">,</span> <span class="s1">&#39;spike_prob&#39;</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_groupings</span><span class="p">)))</span>

    <span class="n">bin_starts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spike_probs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">bin_groupings</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bin_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helper_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">spike_probs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helper_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bin_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helper_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">spikes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
                <span class="n">spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helper_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

            <span class="n">spikes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">spikes</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_items</span>
            <span class="n">spike_probs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikes</span><span class="p">))</span>


    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_starts</span><span class="p">):</span>
        <span class="n">midpoint</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span><span class="n">lookup_series_stepsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_groupings</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">spike_probs</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>

    <span class="n">points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">x_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
    <span class="n">y_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">diff</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">diff</span><span class="p">))</span>

    <span class="n">LUT</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
        <span class="n">LUT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_interpolation_between_pairs</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span><span class="n">y_points</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">LUT</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[92]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">model_data_base.analyze.spike_detection</span> <span class="kn">import</span> <span class="n">spike_in_interval</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[ ]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">outdir</span> <span class="o">=</span> <span class="n">BASEDIR</span> <span class="o">+</span> <span class="s1">&#39;precalculated_WNI_values/&#39;</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[95]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">rm_inference_timepoint</span> <span class="o">=</span> <span class="mi">260</span>
<span class="n">WNI_df</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">spike_times_df</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">whisker</span> <span class="ow">in</span> <span class="n">whiskers</span><span class="p">:</span>
    <span class="n">spike_times_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">{}</span><span class="s2">/spike_times_MCM/</span><span class="si">{}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">)))</span>

     <span class="c1"># adapt according to where you saved (this loads the provided precalculated WNI values for C2 whisker)</span>
    <span class="n">WNI_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;precalculated_WNI_values__model_1__</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">whisker</span><span class="p">)))</span>

<span class="c1">#     key = &#39;{}__{}.csv&#39;.format(model, whisker)</span>
<span class="c1">#     WNI_df.append(pd.read_csv(outdir + key))</span>

<span class="n">WNI_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">WNI_df</span><span class="p">)</span>
<span class="n">spike_times_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">spike_times_df</span><span class="p">)</span>


<span class="n">tdf</span> <span class="o">=</span> <span class="n">WNI_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rm_inference_timepoint</span><span class="p">)]</span>
<span class="n">wni_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tdf</span><span class="p">)</span>
<span class="n">spike_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spike_in_interval</span><span class="p">(</span><span class="n">spike_times_df</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">wni_values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)</span>

<span class="n">rp</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1"># filter out trials with a spike in the last X ms</span>
<span class="n">spike_before</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spike_in_interval</span><span class="p">(</span><span class="n">spike_times_df</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span> <span class="o">-</span> <span class="n">rp</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span><span class="p">))</span>

<span class="n">nonlinearity</span> <span class="o">=</span> <span class="n">variable_stepsize_nonlinearity</span><span class="p">(</span><span class="n">wni_values</span><span class="p">,</span> <span class="n">spike_times</span><span class="p">,</span> <span class="n">spike_before</span> <span class="o">=</span> <span class="n">spike_before</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/axon/scratch/rfruengel/anaconda2_isf/lib/python2.7/site-packages/ipykernel/__main__.py:73: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[96]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nonlinearity</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[96]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x2b3c4fe4ce90&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_62_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_62_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[97]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;nonlinearity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nonlinearity</span>
</code></pre></div>
</div>
</div>
<h3 id="ISI-dependent-penalty">ISI-dependent penalty<a class="headerlink" href="#ISI-dependent-penalty" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[ ]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">outdir</span> <span class="o">=</span> <span class="n">BASEDIR</span> <span class="o">+</span> <span class="s1">&#39;precalculated_WNI_values/&#39;</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[104]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_ISI_WNI_data</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span><span class="p">):</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__spike_times_MCM__</span><span class="si">{}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">))</span> <span class="k">for</span> <span class="n">whisker</span> <span class="ow">in</span> <span class="n">whiskers</span><span class="p">])</span>
    <span class="c1"># is there a spike in the estimation period?</span>
    <span class="n">st</span><span class="p">[</span><span class="s1">&#39;spike_in_interval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spike_in_interval</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># how long ago was the most recent spike?</span>
    <span class="n">st</span><span class="p">[</span><span class="n">st</span><span class="o">&gt;</span><span class="n">rm_inference_timepoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="n">st</span><span class="p">[</span><span class="s1">&#39;ISI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rm_inference_timepoint</span>

    <span class="c1"># collect WNI values and add them to the dataframe</span>
    <span class="n">wni</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">whisker</span> <span class="ow">in</span> <span class="n">whiskers</span><span class="p">:</span>
        <span class="c1"># adapt according to where you saved (this loads the provided precalculated WNI values for C2 whisker)</span>
        <span class="n">wni_path</span> <span class="o">=</span> <span class="s1">&#39;precalculated_WNI_values__model_1__</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">whisker</span><span class="p">)</span>
<span class="c1">#         wni_path = outdir + &#39;{}__{}.csv&#39;.format(model, whisker)</span>
        <span class="n">wni</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">wni</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">wni_path</span><span class="p">)])</span>

    <span class="n">st</span><span class="p">[</span><span class="s1">&#39;wni_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wni</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rm_inference_timepoint</span><span class="p">)])</span>


    <span class="n">spike_df</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">spike_in_interval</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">ISI</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">80</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">ISI</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="n">no_spike_df</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="o">~</span><span class="n">st</span><span class="o">.</span><span class="n">spike_in_interval</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">ISI</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">80</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">ISI</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>

    <span class="n">spike_isi</span> <span class="o">=</span> <span class="n">spike_df</span><span class="p">[</span><span class="s1">&#39;ISI&#39;</span><span class="p">]</span>
    <span class="n">spike_wni</span> <span class="o">=</span> <span class="n">spike_df</span><span class="p">[</span><span class="s1">&#39;wni_value&#39;</span><span class="p">]</span>

    <span class="n">no_spike_isi</span> <span class="o">=</span> <span class="n">no_spike_df</span><span class="p">[</span><span class="s1">&#39;ISI&#39;</span><span class="p">]</span>
    <span class="n">no_spike_wni</span> <span class="o">=</span> <span class="n">no_spike_df</span><span class="p">[</span><span class="s1">&#39;wni_value&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">,</span> <span class="n">no_spike_isi</span><span class="p">,</span> <span class="n">no_spike_wni</span><span class="p">,</span> <span class="n">st</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[131]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_isi_boundary_95</span><span class="p">(</span><span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">signchange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">linear_interpolation_between_pairs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span> <span class="c1"># don&#39;t need to interpolate, causes assertion error</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="p">[</span><span class="n">lv</span> <span class="k">for</span> <span class="n">lv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">signchange</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">lv</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">lv</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">)]</span>
    <span class="c1">#         X[lv] &lt;= x &lt; X[lv + 1]]</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">pair</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Y</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">pair</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">c</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">l</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">I</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># sort by WNI values</span>
    <span class="n">to_drop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spike_wni</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span> <span class="c1"># drop lowest 5%</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">to_drop</span><span class="p">:]</span>

    <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># sort by ISI again</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">y_min</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">y</span>

    <span class="n">x_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
    <span class="n">y_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>

    <span class="n">ISI_boundary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ISI</span> <span class="ow">in</span> <span class="n">ISI_boundary</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">ISI_boundary</span><span class="p">[</span><span class="n">ISI</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_interpolation_between_pairs</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">,</span> <span class="n">ISI</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ISI_boundary</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[132]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">,</span> <span class="n">no_spike_isi</span><span class="p">,</span> <span class="n">no_spike_wni</span><span class="p">,</span> <span class="n">st</span> <span class="o">=</span> <span class="n">fetch_ISI_WNI_data</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rm_inference_timepoint</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[133]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">ISI_penalty</span> <span class="o">=</span> <span class="n">get_isi_boundary_95</span><span class="p">(</span><span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[134]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">plot_ISI_cloud</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">,</span> <span class="n">no_spike_isi</span><span class="p">,</span> <span class="n">no_spike_wni</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">no_spike_isi</span><span class="p">,</span> <span class="n">no_spike_wni</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">rasterized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">rasterized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;no spike&#39;</span><span class="p">,</span> <span class="s1">&#39;spike&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;inter spike interval (ms)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;weighted net input&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[135]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">plot_ISI_cloud</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">spike_isi</span><span class="p">,</span> <span class="n">spike_wni</span><span class="p">,</span> <span class="n">no_spike_isi</span><span class="p">,</span> <span class="n">no_spike_wni</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ISI_penalty</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[135]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x2b3c5e309690&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_71_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_71_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[136]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># when using the ISI-dependent penalty for simulations, you should subtract the baseline value, i.e.</span>
<span class="n">ISI_penalty_simulations</span> <span class="o">=</span> <span class="n">ISI_penalty</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">ISI_penalty</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[137]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ISI_penalty_simulations</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[137]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x2b3c5da9d3d0&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_73_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_73_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[142]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;ISI_penalty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ISI_penalty</span>
</code></pre></div>
</div>
</div>
<h2 id="Reduced-model-simulations">Reduced model simulations<a class="headerlink" href="#Reduced-model-simulations" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[17]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[157]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># load reduced models which we provide, or use ones that you generated above</span>
<span class="n">rm_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__reduced_model_parameters.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">rm</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">rm</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[21]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;model </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;spatiotemporal_filters&#39;</span><span class="p">]</span>
    <span class="n">s_exc</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;s_exc&#39;</span><span class="p">]</span>
    <span class="n">s_inh</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;s_inh&#39;</span><span class="p">]</span>
    <span class="n">t_exc</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;t_exc&#39;</span><span class="p">]</span>
    <span class="n">t_inh</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;t_inh&#39;</span><span class="p">]</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_exc</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_inh</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;somadistance (um)&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_exc</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_inh</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;contribution to spiking&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;contribution to spiking&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>

    <span class="n">nonlinearity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;nonlinearity&#39;</span><span class="p">])</span>
    <span class="n">nonlinearity</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">nonlinearity</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">nonlinearity</span> <span class="o">=</span> <span class="n">nonlinearity</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nonlinearity</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AP probability&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;WNI&#39;</span><span class="p">)</span>

    <span class="n">penalty</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;ISI_penalty&#39;</span><span class="p">])</span>
    <span class="n">penalty</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">penalty</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">penalty</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;WNI penalty&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time since last spike (ms)&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_0.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_2.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_3.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_4.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_5.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_6.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_78_6.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[140]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ReducedModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_dict</span><span class="p">,</span> <span class="n">LUT</span><span class="p">,</span> <span class="n">ISI_penalty</span><span class="p">,</span> <span class="n">spatial_bin_size</span> <span class="o">=</span> <span class="mi">50</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_dict</span> <span class="o">=</span> <span class="n">kernel_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LUT</span> <span class="o">=</span> <span class="n">LUT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ISI_penalty</span> <span class="o">=</span> <span class="n">ISI_penalty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatial_bin_size</span> <span class="o">=</span> <span class="n">spatial_bin_size</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SAexc</span><span class="p">,</span> <span class="n">SAinh</span><span class="p">,</span> <span class="n">return_WNI</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Apply the reduced model to synaptic input to get a list containing output spike times.</span>
<span class="sd">        SAexc, SAinh: numpy arrays containing spatiotemporally binned synaptic inputs, shape (spatial bins, trials, temporal bins)</span>
<span class="sd">        return_WNI: bool</span>
<span class="sd">            full_trace returns a dataframe containing WNI values at all timepoints along with spike times.</span>
<span class="sd">            False returns spike times dataframe only.&#39;&#39;&#39;</span>
        <span class="n">s_exc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;s_exc&#39;</span><span class="p">]</span>
        <span class="n">s_inh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;s_inh&#39;</span><span class="p">]</span>
        <span class="n">t_exc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;t_exc&#39;</span><span class="p">]</span>
        <span class="n">t_inh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_dict</span><span class="p">[</span><span class="s1">&#39;t_inh&#39;</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">SAexc</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">SAinh</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">LUT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LUT</span>

        <span class="n">WNI_boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISI_penalty</span>

        <span class="n">spatial_bins</span> <span class="o">=</span> <span class="n">SAexc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_trials</span> <span class="o">=</span> <span class="n">SAexc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">timebins</span> <span class="o">=</span> <span class="n">SAexc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">WNI_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">timebins</span><span class="p">))</span>

        <span class="n">SAinh_cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">timebins</span><span class="p">))</span>
        <span class="n">SAexc_cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">timebins</span><span class="p">))</span>

        <span class="n">spike_times_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">timebin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">timebins</span><span class="p">):</span>
            <span class="c1">## get excitatory and inhibitory input, spatially binned for the CURRENT timebin</span>
            <span class="n">SAexc_timebin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">spatial_bins</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">dist</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spatial_bins</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
                    <span class="n">SAexc_timebin</span><span class="p">[</span><span class="n">dist</span><span class="p">][</span><span class="n">cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">SAexc</span><span class="p">[</span><span class="n">dist</span><span class="p">][</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="p">]</span>

            <span class="n">SAinh_timebin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">spatial_bins</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">dist</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spatial_bins</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
                    <span class="n">SAinh_timebin</span><span class="p">[</span><span class="n">dist</span><span class="p">][</span><span class="n">cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">SAinh</span><span class="p">[</span><span class="n">dist</span><span class="p">][</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="p">]</span>

            <span class="c1">## apply spatial kernel to the current timebin</span>
            <span class="n">SAexc_timebin</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAexc_timebin</span><span class="p">,</span> <span class="n">s_exc</span><span class="p">)])</span>
            <span class="n">SAinh_timebin</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAinh_timebin</span><span class="p">,</span> <span class="n">s_inh</span><span class="p">)])</span>



            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
                <span class="n">SAinh_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="p">]</span> <span class="o">=</span> <span class="n">SAinh_timebin</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span>
                <span class="n">SAexc_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="p">]</span> <span class="o">=</span> <span class="n">SAexc_timebin</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span>



            <span class="c1">## apply temporal kernel</span>
            <span class="n">spikes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">timebin</span> <span class="o">-</span> <span class="mi">80</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">SAexc_window</span> <span class="o">=</span> <span class="n">SAexc_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="o">-</span><span class="mi">79</span><span class="p">:</span><span class="n">timebin</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">SAinh_window</span> <span class="o">=</span> <span class="n">SAinh_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">timebin</span><span class="o">-</span><span class="mi">79</span><span class="p">:</span><span class="n">timebin</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">SAexc_window</span> <span class="o">=</span> <span class="n">SAexc_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">timebin</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">SAinh_window</span> <span class="o">=</span> <span class="n">SAinh_cumulative</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">timebin</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>


                <span class="n">SAexc_window</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAexc_window</span><span class="p">,</span> <span class="n">t_exc</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">SAexc_window</span><span class="p">):])])</span>
                <span class="n">SAinh_window</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">o</span><span class="o">*</span><span class="n">s</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SAinh_window</span><span class="p">,</span> <span class="n">t_inh</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">SAinh_window</span><span class="p">):])])</span>

                <span class="c1">## get weighted net input for each cell</span>
                <span class="n">WNI</span> <span class="o">=</span> <span class="n">SAexc_window</span> <span class="o">+</span> <span class="n">SAinh_window</span>
                <span class="n">WNI_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cell</span><span class="p">,</span> <span class="n">timebin</span><span class="p">]</span> <span class="o">=</span> <span class="n">WNI</span>

                <span class="c1"># check the last 80 bins for a spike, apply WNI penalty if there was</span>
                <span class="n">min_index</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">timebin</span> <span class="o">&lt;</span> <span class="mi">80</span> <span class="k">else</span> <span class="n">timebin</span><span class="o">-</span><span class="mi">80</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">spike_times_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cell</span><span class="p">,</span> <span class="n">min_index</span><span class="p">:</span><span class="n">timebin</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#if there was a spike in the last 80 ms</span>
                    <span class="n">last_spike_interval</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spike_times_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cell</span><span class="p">,</span> <span class="n">min_index</span><span class="p">:</span><span class="n">timebin</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">penalty</span> <span class="o">=</span> <span class="n">WNI_boundary</span><span class="p">[</span><span class="o">-</span><span class="n">last_spike_interval</span><span class="p">]</span>
                    <span class="n">WNI</span> <span class="o">-=</span> <span class="n">penalty</span>


                <span class="c1">## get spike probability from WNI</span>
                <span class="k">if</span> <span class="n">WNI</span> <span class="o">&gt;</span> <span class="n">LUT</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
                    <span class="n">spiking_probability</span> <span class="o">=</span> <span class="n">LUT</span><span class="p">[</span><span class="n">LUT</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
                <span class="k">elif</span> <span class="n">WNI</span> <span class="o">&lt;</span> <span class="n">LUT</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
                    <span class="n">spiking_probability</span> <span class="o">=</span> <span class="n">LUT</span><span class="p">[</span><span class="n">LUT</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spiking_probability</span> <span class="o">=</span> <span class="n">LUT</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">WNI</span><span class="p">)]</span>

                <span class="c1">## spike or not?</span>
                <span class="k">if</span> <span class="n">spiking_probability</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">():</span>
                    <span class="n">spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">spike_times_df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">timebin</span><span class="p">)]</span> <span class="o">=</span> <span class="n">spikes</span>

        <span class="k">if</span> <span class="n">return_WNI</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spike_times_df</span><span class="p">,</span> <span class="n">WNI_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spike_times_df</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[ ]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">filters</span> <span class="o">=</span> <span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;spatiotemporal_filters&#39;</span><span class="p">]</span>
<span class="n">nonlinearity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;nonlinearity&#39;</span><span class="p">])</span>
<span class="n">nonlinearity</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">nonlinearity</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">nonlinearity</span> <span class="o">=</span> <span class="n">nonlinearity</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">penalty</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rm_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;ISI_penalty&#39;</span><span class="p">])</span>
<span class="n">penalty</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">penalty</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[144]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">rm</span> <span class="o">=</span> <span class="n">ReducedModel</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="p">,</span> <span class="n">penalty</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[145]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">BASEDIR</span> <span class="o">+</span> <span class="s2">&quot;model_</span><span class="si">{}</span><span class="s2">__binned_synapse_activations_spatiotemporal_EI__</span><span class="si">{}</span><span class="s2">.npz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">whisker</span><span class="p">))</span>
<span class="n">sa</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="s1">&#39;arr_0&#39;</span><span class="p">]</span>
<span class="n">SAexc</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,:]</span>
<span class="n">SAinh</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:,:]</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[146]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">SAexc</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">SAinh</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># (spatial bins, trials ,temporal bins)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[146]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((30, 81000, 400), (30, 81000, 400))
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[147]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">spike_times</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">SAexc</span><span class="p">[:,</span> <span class="mi">4000</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span> <span class="p">:],</span> <span class="n">SAinh</span><span class="p">[:,</span> <span class="mi">4000</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span> <span class="p">:])</span> <span class="c1"># select the same trials as we visualised for the MCM</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[148]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">spike_times</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[148]:
</code></pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>390</th>
      <th>391</th>
      <th>392</th>
      <th>393</th>
      <th>394</th>
      <th>395</th>
      <th>396</th>
      <th>397</th>
      <th>398</th>
      <th>399</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1970</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1971</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1973</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1974</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1975</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1976</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1977</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1978</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1979</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1980</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1981</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1982</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1983</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1984</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1985</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1986</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1987</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1988</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1989</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1991</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1994</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1995</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1996</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1998</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1999</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2000 rows × 400 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[152]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># reformat the spike times so that instead of 1 or 0 for each timebin per cell, each cell has a list of its spike times</span>
<span class="n">st_reformat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">spike_times</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))))</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">spike_times</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">nspikes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">timebin</span> <span class="ow">in</span> <span class="n">spike_times</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">spike_times</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cell</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">timebin</span><span class="p">)]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">st_reformat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cell</span><span class="p">,</span> <span class="n">nspikes</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timebin</span><span class="p">)</span>
            <span class="n">nspikes</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[150]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># the sensory stimulus was always applied at 245 ms</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">temporal_binning_pd</span><span class="p">(</span><span class="n">st_reformat</span><span class="p">),</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;AP probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[150]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0, 300)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_87_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_87_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[151]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><code><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">rasterplot</span><span class="p">(</span><span class="n">st_reformat</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;trial index&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>[151]:
</code></pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.text.Text at 0x2b3c9ed9c510&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_88_1.png" src="../../_images/tutorials_4._reduced_models_4.1_Generalized_Linear_Models_88_1.png" />
</div>
</div>






                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../3.%20multiscale%20models/3.1%20Multiscale%20modeling.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Multi-scale modeling" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Multi-scale modeling
            </div>
          </div>
        </a>
      
      
        
        <a href="../../rst_assets/installation.html" class="md-footer__link md-footer__link--next" aria-label="Next: Installation" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Installation
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2025 Max Planck Institute for Neurobiology of Behavior - CAESAR.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    7.1.2.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../_static/tabs.js?v=3ee01567"></script>
        <script src="../../_static/js/video.js?v=a9b6335e"></script>
        <script src="../../_static/design-tabs.js?v=36754332"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script id="MathJax-script" src="../../_static/mathjax/tex-mml-chtml.js?v=cadf963e"></script>
    
  </body>
</html>
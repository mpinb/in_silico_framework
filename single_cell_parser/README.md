# Single Cell Parser

This module has the functionality to run single trials of simulations using NEURON. 

It contains methods for parsing cell data, such as morphology and membrane properties; methods for converting cellular data to other formats; applying synapses to a cell morphology given certain biological constraints (see [synapse_mapper](./synapse_mapper.py) and [synapse](./synapse.py)) etc...

It provides methods for interacting with NEURON or Amira files in Python. 

While it is possible to launch simulations with this module, to run many simulations in a scalable way (using a high-perfomance cluster) use the modules [simrun2](../simrun2/) and/or [simrun3](../simrun3/).

This module makes heavy use of [single cell analyser](../single_cell_analyzer/) as well.

This module handles parameter files used during the simulations to specify certain simulation constrains:

- cell_param: specifies ion channel conductances (mechanisms) for all structures of the cell
  To access the different structures of a cell:
  cell_param.neuron.keys()
	['Myelin', 'Soma', 'AIS', 'filename', 'Dendrite', 'ApicalDendrite']
  filename: path to hoc morphology file
 
- hoc: neuron morphology file generated by reconstructing a neuron (with tools like Neuromorph).
  The morphology is specified as a tree structure: the different sections of a neuron (pieces separated between branching points or branches endings) are connected in order. Each section is formed by a set of points, defined by their 3D coordinates and the diameter of the neuron structure at that point (pt3dadd -> x, y, z, diameter).
  
- con: maps between presynaptic cells and synapses
  # Type - cell ID - synapse ID
  L6cc_A3	0	0
  L6cc_A3	1	1
  L6cc_A3	2	2
  
- syn: specifies the exact position of each synapse on the hoc morphology
  # Type - section - section.x
  VPM_E1	130	0.190509288017
  VPM_E1	9	0.368760777084
  VPM_E1	110	0.0
  Here, section referes to the ID of the section in the cell object (morphology). 
  section.x specifies, where along that section the synapse is placed. If x == 0, this is the beginning of the section, if x == 1 this is the end of the section.
  
- network_param: activation of presynaptic cells and synapses
  Information to describe the activation of presynaptic cells and synapses during the scenario we want to simulate, given our cell morphology and the anatomical network realization (connectivity sampled from the statistical connectome model).
  To see the different cells present in our network:
  network_param.network.keys()[:10] 
  ['L45Peak_D1', 'L45Peak_D2', 'L5tt_B3', 'L45Peak_Delta', 'L2_C1', 'L6ct_E3', 'L2_C3', 'L2_C2', 'L2_C4', 'L6cc_Gamma']
  Every cell in our network has:
  - cellNr: Example: 379
  - synapses: which at the same time has:
    - releaseProb: probability that a presynaptic activation causes a synapse activation (and therefore a postsynaptic EPSP). A synapse is active or not (binary).
The amplitude of an EPSP is constant but it will be attenuated when it reaches the soma depending on where the synapse was located.
    - distributionFile: syn file
    - receptors:
      - glutamate_syn:
        - threshold
        - delay
        - parameter
        - weight: max conductance that the synapse reaches. 50% AMPA and 50% NMDA. Example: [1.59, 1.59]
        - connectionFile: con file
  - celltype: is going to determine how the activity of this cell is generated. Example of cell type:
    - pointcell: does not have a morphology. Example characteristics of a point cell:
      - distribution: how the activity of presynaptic cells should be generated. It should be generated from a PSTH as a poisson train: PSTH_poissontrain_v2 (v2 more efficient than PSTH_poissontrain)
      - probabilities: probabilities in the PSTH
      - intervals: time bins borders of the PSTH
      - offset: timepoint at which the evoked activity starts
    - spiketrain

> __Warning__: it is not recommended to change these modules, as they are heavily tested. Refactor/adapt at your own risk.
